var dealerSum = 0;
var playerSum = 0;
var playerCurrency = 100;
var currencyInput = document.getElementById("currency-to-bet").value;
var currentCurrency = document.getElementById("current-currency");
currentCurrency.innerText = `Current Funds: $${playerCurrency}`;

var dealerAceCount = 0;
var playerAceCount = 0;
// will be used to determine if ace's value = 1 or 11 //

var starterDealer;
var hidden;
var deck;
var canHit = true; 
/* allows player to hit is sum is <= 21*/
var canBet = true;
/* allows player to bet only once per round */
var canStay = true;
/* allows player to stay only after hitting */

window.onload = function() {
    buildDeck();
    shuffleDeck();
    startGame();
};

function buildDeck() {
    let values = ["A", "2", "3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K"];
    let types = ["C", "D", "H", "S"];
    deck = [];

    for (let i = 0; i < types.length; i++) {
        for(let j = 0; j < values.length; j++) {
            deck.push(values[j] + "-" + types[i]); /*will create the deck of 52 cards */
        };
    };
};

function shuffleDeck() {
    for (let i = 0; i < deck.length; i++) {
        let j = Math.floor(Math.random() * deck.length);
        let temp = deck[i];
        deck[i] = deck[j];
        deck[j] = temp;
    };
};

function startGame() {
    hidden = deck.pop();
    dealerSum += getValue(hidden);
    dealerAceCount += checkAce(hidden);

    starterDealer = deck.pop();
    dealerSum += getValue(starterDealer);
    dealerAceCount += checkAce(starterDealer);
    let starterCardImage = document.getElementById("starter-card");
    starterCardImage.src = "./CardDeck/" + starterDealer + ".png";

    for(let i = 0; i < 2; i++) {
        let cardImage = document.createElement("img");
        cardImage.id = "playerCard-img";
        let card  = deck.pop();
        cardImage.src = "./CardDeck/" + card + ".png";
        playerSum += getValue(card);
        playerAceCount += checkAce(card);
        document.getElementById("player-cards").append(cardImage);
    };
};

document.getElementById("hit").addEventListener("click", hit);
document.getElementById("stay").addEventListener("click", stay);
document.getElementById("bet-btn").addEventListener("click", betSystem);
document.getElementById("next-round").addEventListener("click", nextRound);

function betSystem(currencyInput) {
    if(!canBet) {
        console.log("bets are off!!");
        return;
    };

    canBet = false;
    canStay = true;
    currencyInput = parseInt(document.getElementById("currency-to-bet").value);

    if (currencyInput > playerCurrency) {
        alert("INSUFFICIENT FUNDS!!");
        return currentCurrency.innerText = `Current Funds: $${playerCurrency}`;
    } else if (!currencyInput) {
        alert("ENTER AN AMOUNT TO PLAY!!");
    };

    document.getElementById("player-sum").innerText = `$${currencyInput}`;
    playerCurrency -= currencyInput;
    currentCurrency.innerText = `Current Funds: $${playerCurrency}`;
};

function hit() {
    if(!canHit) {
        return;
    };

    let cardImage = document.createElement("img");
    let card  = deck.pop();
    cardImage.src = "./CardDeck/" + card + ".png";
    playerSum += getValue(card);
    playerAceCount += checkAce(card);
    document.getElementById("player-cards").append(cardImage);

    if (reduceAce(playerSum, playerAceCount) >= 21) { //A, J, 8 -> 1 + 10 + 8
        canHit = false;
    };
};

function stay() {
    if(!canStay) {
        console.log("stay button disabled");
        return;
    };

    canHit = false;
    canStay = false;
    
    document.getElementById("next-round").classList.remove("hidden");

    while(dealerSum <= 17) {
        let newDealerCard = document.createElement("img");
        let dealersCard  = deck.pop();
        newDealerCard.src = "./CardDeck/" + dealersCard + ".png";
        dealerSum += getValue(dealersCard);
        dealerAceCount += checkAce(dealersCard);
        document.getElementById("dealer-cards").append(newDealerCard); /*will make new divs for the newly added cards for dealer */
    };

    dealerSum = reduceAce(dealerSum, dealerAceCount);
    playerSum = reduceAce(playerSum, playerAceCount);

    resultCheck();

};

function nextRound() {
    document.getElementById("next-round").classList.add("hidden");
    dealerSum = 0;
    playerSum = 0;
    dealerAceCount = 0;
    playerAceCount = 0;
    canBet = true;

    document.getElementById("dealer-sum").innerText = "";
    document.getElementById("player-sum").innerText = "";
    document.getElementById("results").innerText = "";

    document.getElementById("dealer-cards").innerHTML = `<img id="starter-card"><img id="hidden-card" src="./CardDeck/BACK.png">`;
    document.getElementById("player-cards").innerHTML = "";

    buildDeck();
    shuffleDeck();
    startGame();
};

function getValue(card) {
    let data = card.split("-"); // "4-C" will turn into -> ["4", "C"]
    let value = data[0];

    if(isNaN(value)) { /*A J Q K */
        if(value == "A") {
            return 11;
        };
        return 10;
    };

    return parseInt(value);
};

function checkAce(card) {
    if (card[0] == "A") {
        return 1;
    };
    return 0;
};

function reduceAce(playerSum, playerAceCount) {
    while (playerSum > 21 && playerAceCount > 0) {
        playerSum -= 10;
        playerAceCount -= 1;
    }
    return playerSum;
};

function resultCheck() {
    console.log("Checking Results...");
    console.log(playerSum);
    console.log(dealerSum);

    let message = "";
    document.getElementById("hidden-card").src = "./CardDeck/" + hidden + ".png";
    reduceAce(playerSum, playerAceCount);

        if (playerSum > 21) {
            message = "YOU LOSE!!";
            document.getElementById("player-sum").innerText = playerSum + " -$" + currencyInput;
            currentCurrency.innerText = `Current Funds: $${playerCurrency}`;
        }
        else if (dealerSum > 21) {
            message = "YOU WIN!!";
            document.getElementById("player-sum").innerText = playerSum + " +$" + currencyInput;
            playerCurrency += parseInt(currencyInput * 2);
            currentCurrency.innerText = `Current Funds: $${playerCurrency}`;
        }
        else if (playerSum === dealerSum) {
            message = "IT'S A TIE!!";
            document.getElementById("player-sum").innerText = playerSum + " +$0";
            playerCurrency = playerCurrency + parseInt(currencyInput);
            currentCurrency.innerText = `Current Funds: $${playerCurrency}`;
        }
        else if (playerSum > dealerSum) {
            message = "YOU WIN!!";
            document.getElementById("player-sum").innerText = playerSum + " +$" + currencyInput;
            playerCurrency += parseInt(currencyInput * 2);
            currentCurrency.innerText = `Current Funds: $${playerCurrency}`;
        }
        else if (dealerSum > playerSum) {
            message = "YOU LOSE!!";
            document.getElementById("player-sum").innerText = playerSum + " -$" + currencyInput;
            currentCurrency.innerText = `Current Funds: $${playerCurrency}`;
        }
        if (playerSum == 21) {
            message = "YOU WIN!!";
            document.getElementById("player-sum").innerText = playerSum + " +$" + (currencyInput * 1.5);
            playerCurrency += parseInt(currencyInput * 0.5);
            currentCurrency.innerText = `Current Funds: $${playerCurrency}`;
        } 
        else if (dealerSum == 21) {
            message = "YOU LOSE!!";
            document.getElementById("player-sum").innerText = playerSum + " -$" + currencyInput;
            currentCurrency.innerText = `Current Funds: $${playerCurrency}`;
        };

      document.getElementById("dealer-sum").innerText = dealerSum;
      document.getElementById("results").innerText = message;
    };
